---
import Layout from '../layouts/Layout.astro';
import ThemeSelector from '../components/ThemeSelector.astro';
import companies from '../data/companies.json';
import { themes, defaultTheme, getTheme } from '../config/themes';
import '../styles/global.css';

// Get theme from URL parameter (will be handled by client-side JS)
// Default to pop-art for SSG
const currentTheme = getTheme(defaultTheme);

// Import theme CSS dynamically
if (currentTheme.id === 'pop-art') {
  await import('../styles/themes/pop-art.css');
} else if (currentTheme.id === 'web2') {
  await import('../styles/themes/web2.css');
}

const validCompanies = companies.filter((company) => company.name);
const hiringCount = validCompanies.filter((company) => company.jobs_url).length;
---

<Layout title="Uppsala Tech Map">
  <ThemeSelector />



  <h2 class="theme-title" data-theme-target="title" style="margin-top: 2rem;">Discover Tech Companies!</h2>
  <p>
    Join the conversation in the Uppsala Tech Community Slack by emailing
    <a href="mailto:hello@uppsalatech.se" class="theme-link" data-theme-target="link">hello@uppsalatech.se</a>.
  </p>

  <div class="cards">
    {validCompanies.map((company, index) => {
        const id = company.name!.replace(/\s/g, '');
        return (
          <div class="card theme-card" id={id} data-index={index} data-theme-target="card">
            <a href={company.url} class="name theme-name" data-theme-target="name">{company.name}</a>
            <p>{company.description}</p>
            {company.jobs_url && (
              <a href={company.jobs_url} class="jobs_url theme-jobs" data-theme-target="jobs">Hiring!</a>
            )}
          </div>
        );
      })}
  </div>

  <div style="margin-top: 30px; text-align: center;">
    <a href="https://github.com/uppsalatech/uppsalatechmap/edit/master/companies.json" class="theme-link" data-theme-target="link">
      Add your own company to the list
    </a>
  </div>
</Layout>

<script>
  import { getCurrentTheme, applyTheme } from '../lib/themeManager';
  import { initializeTheme } from '../lib/themeInitializers';

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', () => {
    const currentTheme = getCurrentTheme();
    applyTheme(currentTheme);

    // Initialize theme-specific features
    const cards = document.querySelectorAll<HTMLElement>('[data-theme-target="card"]');
    initializeTheme(currentTheme, cards);

    // Set dropdown value
    const dropdown = document.getElementById('theme-dropdown') as HTMLSelectElement;
    if (dropdown) {
      dropdown.value = currentTheme;
    }
  });

  // Handle theme changes
  const dropdown = document.getElementById('theme-dropdown');
  if (dropdown) {
    dropdown.addEventListener('change', (e) => {
      const newTheme = (e.target as HTMLSelectElement).value;
      const url = new URL(window.location.href);
      url.searchParams.set('theme', newTheme);
      window.location.href = url.toString();
    });
  }
</script>

<style>
 
  @keyframes badge-pop {
    0% {
      transform: scale(0) rotate(-180deg);
      opacity: 0;
    }
    70% {
      transform: scale(1.1) rotate(10deg);
    }
    100% {
      transform: scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  .card-entrance {
    animation: card-slide-in 0.5s ease-out forwards;
    opacity: 0;
  }

  @keyframes card-slide-in {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
