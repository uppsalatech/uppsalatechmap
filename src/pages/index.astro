---
import Layout from '../layouts/Layout.astro';
import companies from '../data/companies.json';
import '../styles/global.css';
import '../styles/pop-art.css';

const validCompanies = companies.filter((company) => company.name);
const hiringCount = validCompanies.filter((company) => company.jobs_url).length;
---

<Layout title="Uppsala Tech Map">


  <h2 class="pop-art-title" style="margin-top: 2rem;">Discover Tech Companies!</h2>
  <p>
    Join the conversation in the Uppsala Tech Community Slack by emailing
    <a href="mailto:hello@uppsalatech.se" style="color: #ff0055; font-weight: bold;">hello@uppsalatech.se</a>.
  </p>

  <div class="cards">
    {validCompanies.map((company, index) => {
        const id = company.name!.replace(/\s/g, '');
        return (
          <div class="card pop-art-card" id={id} data-index={index}>
            <a href={company.url} class="name pop-art-name">{company.name}</a>
            <p>{company.description}</p>
            {company.jobs_url && (
              <a href={company.jobs_url} class="jobs_url pop-art-jobs">Hiring!</a>
            )}
          </div>
        );
      })}
  </div>

  <div style="margin-top: 30px; text-align: center;">
    <a href="https://github.com/uppsalatech/uppsalatechmap/edit/master/companies.json" style="color: #ff0055; font-weight: bold; text-decoration: underline;">
      Add your own company to the list
    </a>
  </div>
</Layout>

<script>
  // Random action words for comic effect
  const actionWords = ["POW!", "BAM!", "ZAP!", "WHAM!", "BOOM!", "CRASH!", "KAPOW!", "THWACK!", "BIFF!", "SOCK!"];
  const colors = ["#ffff00", "#00d9ff", "#ff0055", "#ff6b00"];

  // Randomize action words on cards
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll<HTMLElement>('.pop-art-card');

    cards.forEach((card, index) => {
      // Add entrance animation delay
      const delay = index * 50;
      card.style.animationDelay = `${delay}ms`;
      card.classList.add('card-entrance');

      // Set random action word and color
      const randomWord = actionWords[Math.floor(Math.random() * actionWords.length)];
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      const randomRotation = Math.floor(Math.random() * 16) + 10; // 10-25 degrees

      // Random position (top-right, top-left, bottom-right, bottom-left)
      const positions = [
        { top: '-40px', right: '-40px', bottom: 'auto', left: 'auto', topHover: '-20px', rightHover: '-20px', bottomHover: 'auto', leftHover: 'auto' },
        { top: '-40px', right: 'auto', bottom: 'auto', left: '-40px', topHover: '-20px', rightHover: 'auto', bottomHover: 'auto', leftHover: '-20px' },
        { top: 'auto', right: '-40px', bottom: '-40px', left: 'auto', topHover: 'auto', rightHover: '-20px', bottomHover: '-20px', leftHover: 'auto' },
        { top: 'auto', right: 'auto', bottom: '-40px', left: '-40px', topHover: 'auto', rightHover: 'auto', bottomHover: '-20px', leftHover: '-20px' }
      ];
      const randomPosition = positions[Math.floor(Math.random() * positions.length)];

      card.setAttribute('data-action-word', randomWord);
      card.style.setProperty('--action-color', randomColor);
      card.style.setProperty('--action-rotation', `${randomRotation}deg`);
      card.style.setProperty('--action-top', randomPosition.top);
      card.style.setProperty('--action-right', randomPosition.right);
      card.style.setProperty('--action-bottom', randomPosition.bottom);
      card.style.setProperty('--action-left', randomPosition.left);
      card.style.setProperty('--action-top-hover', randomPosition.topHover);
      card.style.setProperty('--action-right-hover', randomPosition.rightHover);
      card.style.setProperty('--action-bottom-hover', randomPosition.bottomHover);
      card.style.setProperty('--action-left-hover', randomPosition.leftHover);
    });

    // Animate counters
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
      const target = parseInt(stat.getAttribute('data-target') || '0');
      animateCounter(stat, target);
    });
  });

  function animateCounter(element: Element, target: number) {
    let current = 0;
    const increment = Math.ceil(target / 30);
    const duration = 1000;
    const stepTime = duration / (target / increment);

    const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        element.textContent = target.toString();
        clearInterval(timer);
      } else {
        element.textContent = current.toString();
      }
    }, stepTime);
  }
</script>

<style>
  .hero-stats {
    display: flex;
    gap: 2rem;
    justify-content: center;
    margin: 2rem 0;
    flex-wrap: wrap;
  }

  .stat-badge {
    background: linear-gradient(135deg, #ff0055, #ff6b00);
    border: 5px solid #000;
    border-radius: 50%;
    width: 180px;
    height: 180px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.3);
    position: relative;
    animation: badge-pop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  .hiring-badge {
    background: linear-gradient(135deg, #00d9ff, #0080ff);
  }

  .stat-badge::before {
    content: '';
    position: absolute;
    inset: 8px;
    border: 3px dashed rgba(255, 255, 255, 0.5);
    border-radius: 50%;
  }

  .stat-number {
    font-family: 'Impact', 'Arial Black', sans-serif;
    font-size: 3.5rem;
    color: #ffff00;
    text-shadow: 3px 3px 0 #000;
    line-height: 1;
  }

  .stat-label {
    font-family: 'Impact', 'Arial Black', sans-serif;
    font-size: 0.9rem;
    color: #fff;
    text-shadow: 2px 2px 0 #000;
    letter-spacing: 1px;
    margin-top: 0.5rem;
    text-align: center;
  }

  @keyframes badge-pop {
    0% {
      transform: scale(0) rotate(-180deg);
      opacity: 0;
    }
    70% {
      transform: scale(1.1) rotate(10deg);
    }
    100% {
      transform: scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  .card-entrance {
    animation: card-slide-in 0.5s ease-out forwards;
    opacity: 0;
  }

  @keyframes card-slide-in {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
